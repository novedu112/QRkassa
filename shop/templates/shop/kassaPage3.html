{% extends "shop/base.html" %}
{% load static %}
{% load my_filters %}
{% block title %}Касса 3{% endblock %}

{% block content %}

<audio id="beepSound" src="{% static 'sounds/scaner_beep.mp3' %}" preload="auto"></audio>
<audio id="beepError" src="{% static 'sounds/beepError3.mp3' %}" preload="auto"></audio>
<audio id="successSound" src="{% static 'sounds/success.mp3' %}" preload="auto"></audio>
<audio id="errorSound" src="{% static 'sounds/error.mp3' %}" preload="auto"></audio>

<!-- Анимация черчения галочки после успешной покупки -->
<div class="overlay" id="overlay"></div>
<div class="checkmark-wrapper" id="checkmark-wrapper">
    <svg class="checkmark" viewBox="0 0 52 52">
        <circle class="checkmark-circle" cx="26" cy="26" r="25" fill="none" />
        <path class="checkmark-check" fill="none" d="M14 27l7 7 18-18" />
    </svg>
</div>






    <div class="d-none" id="camera_container">
        <video id="video" width="300" height="200" autoplay></video>
        <canvas id="canvas" style="display:none;"></canvas>
        <p id="result"></p>
    </div>
    <button id="start">Камера</button>
    <button id="stop" style="display:none;">Стоп</button>

    <script>
        const video = document.getElementById('video');
        const canvas = document.getElementById('canvas');
        const context = canvas.getContext('2d');
        const startButton = document.getElementById('start');
        const stopButton = document.getElementById('stop');
        const resultElement = document.getElementById('result');
        const camera_container = document.getElementById('camera_container');
        let videoStream = null;

        startButton.addEventListener('click', async () => {
            camera_container.classList.remove('d-none')
            videoStream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: 'environment' } });
            video.srcObject = videoStream;

            video.setAttribute('playsinline', true); // требуется для iOS
            video.play();

            // Показать кнопку "Стоп"
            stopButton.style.display = 'inline';
            startButton.style.display = 'none';

            // Запускаем процесс сканирования
            requestAnimationFrame(tick);
        });

        stopButton.addEventListener('click', () => {
            stopCamera();
        });

        function stopCamera() {
            camera_container.classList.add('d-none')
            if (videoStream) {
                videoStream.getTracks().forEach(track => track.stop());
                video.srcObject = null; // Отключаем видео
            }
            resultElement.innerText = ''; // Очищаем результат
            stopButton.style.display = 'none'; // Скрываем кнопку "Стоп"
            startButton.style.display = 'inline'; // Показываем кнопку "Начать"
        }

        function tick() {
            if (video.readyState === video.HAVE_ENOUGH_DATA) {
                canvas.height = video.videoHeight;
                canvas.width = video.videoWidth;
                context.drawImage(video, 0, 0, canvas.width, canvas.height);

                const imageData = context.getImageData(0, 0, canvas.width, canvas.height);
                const code = jsQR(imageData.data, canvas.width, canvas.height);

                if (code) {
                    resultElement.innerText = `QR код: ${code.data}`;
                    sendScannedCode2(code.data)
                    stopCamera(); // Остановить камеру после успешного считывания
                }
            }
            requestAnimationFrame(tick);
        }


        function sendScannedCode2(code) {
        if (code) {
            fetch(`/shop/product/${code.toString()}`, {
                method: 'GET', 
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': '{{ csrf_token }}',
                    'X-Source': 'kassa2GetProduct_QR_and_Bar'
                },
            }).then(response => {
                if (!response.ok) {
                    return response.json().then(errorData => {
                        throw new Error(errorData.error || 'Произошла ошибка');
                    });
                }
                return response.json();
            }).then(data => {
                console.log('Ответ от сервера:', data); // Проверка данных от сервера
                if (data.product) {
                    console.log('есть в базе', data.product);
                    addProduct2(data.product);
                } else {
                    console.log('нет в базе');
                    beepError.play();      
                }
            }).catch(err => {
                console.error('Ошибка Catch:', err); // Вывод ошибки
                alert
            });
        }
    }
    </script>









<style>
    .camera-indicator {
    width: 40px; /* Размер круга */
    height: 40px; /* Размер круга */
    background-color: rgb(255, 140, 140); /* Цвет круга */
    border-radius: 50%; /* Закругление границ для создания круга */
    animation: blink 1s infinite; /* Анимация мигания */
    top: 10%;
    left: 90%;
}
@keyframes blink {
    0%, 100% {
        opacity: 1;
    }
    50% {
        opacity: 0; /* Прозрачность на 50% для эффекта мигания */
    }
}
</style>

<div class="form-check sell-checkbox-for-mobile d-none" id="checkbox_for_sell_btn_in_phone">
    <input class="form-check-input" type="checkbox" id="checkbox_for_sell_btn_in_phone_input">
    <label class="form-check-label" for="checkbox_for_sell_btn_in_phone_input">
        Продать
    </label>
</div>



<div class="container esasy-container">

    <div class="d-flex align-items-center justify-content-between sell_row">

        <div>
            <div class="container d-flex" style="align-items: center;">
                <img src="{% static 'icons/keyboard2.png' %}" width="50" id="handQRToggleButton" style="cursor: pointer;">
            
                <div id="qrHandInputContainer" class="d-flex mt-3 d-none">
                    <input type="text" class="form-control me-2" placeholder="Введите значение" style="width: 200px; background-color:rgb(255, 200, 200);" id="qr_hand_input" name="handValue">
                    <button class="btn btn-outline-success btn-sm" onclick="showProducts(document.getElementById('qr_hand_input').value)">Просмотр</button>
                </div>
            </div>   
        </div>

        <!-- Модальное окно Bootstrap для hand_input -->
        <div class="modal fade" id="productModal" tabindex="-1" aria-labelledby="productModalLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="productModalLabel">Список продуктов</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <div class="overflow-auto" style="max-height: 300px;"> <!-- Ограничим высоту с полосой прокрутки -->
                            <ul id="productList" class="list-group">
                                <!-- Список продуктов будет добавлен здесь -->
                            </ul>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Закрыть</button>
                    </div>
                </div>
            </div>
        </div>

        <style>
            .list-group-item:hover {
                background-color: #f8f9fa; /* Цвет фона при наведении (можно изменить) */
                cursor: pointer; /* Указатель мыши */
            }
        </style>

        <script>
            function showProducts(handValue) {
                if (handValue) {
                    fetch(`/shop/get_product_list_from_hand_value/${handValue}`, {
                        method: 'GET',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                    })
                    .then(response => {
                        if (!response.ok) {
                            return response.json().then(errorData => {
                                throw new Error(errorData.error || 'Произошла ошибка');
                            });
                        }
                        return response.json();
                    })
                    .then(data => {
                        console.log('Ответ от сервера:', data); // Проверка данных от сервера
                        const productListElement = document.getElementById('productList');
                        productListElement.innerHTML = ''; // Очистить старые данные

                        if (data.products && data.products.length > 0) {
                            console.log('Продукты найдены', data.products);
                            data.products.forEach(product => {
                                const listItem = document.createElement('li');
                                listItem.className = 'list-group-item';
                                const product_value = `
                                <div class="d-flex justify-content-between" onclick="getProductFromPk(${product.id})">
                                    <div>${product.name}</div>
                                    <div>${product.stock}</div>
                                </div>
                                `;
                                listItem.innerHTML = product_value; // Измените на соответствующее свойство продукта
                                productListElement.appendChild(listItem);
                            });

                            // Открыть модальное окно
                            const productModal = new bootstrap.Modal(document.getElementById('productModal'));
                            productModal.show();
                        } else {
                            console.log('нет продуктов');
                            beepError.play();
                            alert('Нет доступных продуктов.');
                        }
                    })
                    .catch(err => {
                        console.error('Ошибка Catch:', err); // Вывод ошибки
                        alert('Произошла ошибка при загрузке продуктов.');
                    });
                }
            }
        </script>

        <input type="text" class="me-2" placeholder="QR code" style="width: 0px; position: fixed; border: none; text-decoration: none; padding:0; margin:0;" id="qr_apparat_input" inputmode="none">
        

        <div class="form-check me-2">
            <input class="form-check-input" type="checkbox" id="optom_check_box">
            <label class="form-check-label" for="optom_check_box">
                Оптовая цена
            </label>
        </div>
        <div class="d-flex" style="column-gap: 10px;">
            <div style="font-size: 30px; font-weight: bold;" id="show_big_price"></div>
            <button class="btn btn-info buyBtn" id="buyBtn" onclick="toSell(event)">Купить</button>
            <div class="camera-indicator d-none" id="camera-indicator"></div>
        </div>
    </div>
    <br>

    <div class="product-table-wrapper">

    
        <table id="product_table" class="table table-striped table-bordered d-none" style="background-color: white;">
            <thead class="table-dark">
                <tr>
                    <th></th>
                    <th>Название</th>
                    <th>Склад</th>
                    <th>Кол-во</th>
                    <th>М<sup>3</sup></th>
                    <th>Покупка</th>
                    <th>Продажа</th>
                    <th>Оптом</th>
                    <th>Итого</th>

                </tr>
            </thead>
            <tbody id="product_body">
                <!-- Данные будут добавлены динамически через JS -->
            </tbody>
            <tfoot>
                <tr class="table-primary">
                    <td colspan="4" class="text-end"><strong>В сумме:</strong></td>
                    <td id="cubic_meter_footer">0</td>
                    <td id="price_pursache_footer"></td>
                    <td id="total_sum_footer"></td>
                    <td id="total_optom_footer"></td>
                    <td id="totalRow_footer">0</td>
                </tr>
            </tfoot>
        </table>
    </div>


    <!-- для card для телефона -->
    <div class="container mt-5" id="product_table_card">
        <div id="product_table_card_rows">
        </div>

        <div class="card product-card d-none" id="product_footer_card">
            <div class="card-body">
                <div class="d-flex justify-content-between" style="padding: 0 2px; align-items: center;">
                    <div>Итоговая сумма</div>
                    <div class="text-center text-primary" style="font-size: 30px; font-weight: bold;" id="product_umumy_total_card"></div>
                </div>
                <div class="d-flex justify-content-between" style="padding: 0 2px; align-items: center;">
                    <div>M<sup>3</sup></div>
                    <div class="text-center text-primary" style="font-size: 30px; font-weight: bold;" id="product_umumy_total_cubic_card"></div>
                </div>   
            </div>
        </div>
        
        
    </div>
    <style>
        .product-card {
            transition: transform 0.2s;
        }
        .product-card:hover {
            transform: scale(1.05);
        }
    </style>

</div>

<div class="text-dark d-none" 
    style="background-color: #fff; border: 1px solid #ccc; padding: 10px; width: 300px; box-shadow: 0 0 10px rgba(0, 0, 0, 0.1); margin-top: 14px;" 
    id="receipt"
    >
    <div style="text-align: center; margin-bottom: 10px;">
        <h6 class="receipt_shop_name_text" style="font-size: 16px; margin: 0;"></h6>
        <p class="receipts_address_text" style="margin: 3px 0; font-size: 13px;"></p>
        <p class="receipts_store_tel_number_text" style="margin: 3px 0; font-size: 13px;"></p>
    </div>
    <div style="height: 8px; display: flex; margin: 3px 0; font-size: 11px;">
        <span class="product_text_in_heder_to_receipt_rows" style="width: 35%;"></span>
        <span class="count_text_in_heder_to_receipt_rows" style="width: 15%;"></span>
        <span class="price_to_one_ps_text_in_heder_to_receipt_rows" style="width: 30%;"></span>
        <span class="total_text_in_heder_to_receipt_rows"></span>       
    </div>
    <div style="height: 5px; margin: 0; font-size: 11px; border-bottom: 1px rgb(102, 102, 102) dashed;"></div>
    <div class="receipt_items" id="receipt_items_id">
        <!-- <div style="display: flex; margin-bottom: 0px;">
            <span style="margin: 3px 0; font-size: 10px; width: 35%;">Товар 12345</span>
            <span style="margin: 3px 0; font-size: 10px; width: 15%;" id="receipstCount1">1</span>
            <span style="margin: 3px 0; font-size: 10px; width: 30%;" id="receipst1psPrice1">100.00</span>
            <span style="margin: 3px 0; font-size: 10px;" id="receipstTotalPrice1">100.00</span>
        </div>
        <div style="display: flex; justify-content: space-between; margin-bottom: 0px;">
            <span style="margin: 3px 0; font-size: 10px; width: 35%;">Товар 1</span>
            <span style="margin: 3px 0; font-size: 10px; width: 15%;">1</span>
            <span style="margin: 3px 0; font-size: 10px; width: 30%;">100.00</span>
            <span style="margin: 3px 0; font-size: 10px;">100.00</span>
        </div> -->
    </div>
    <div style="height: 5px; margin: 0; font-size: 11px; border-top: 1px rgb(102, 102, 102) dashed;"></div>
    <div class="receipt_total" id="receipt_total" style="font-weight: bold; margin-top: 5px; text-align: right; margin: 3px 0; font-size: 11px;">
        <span id="receiptsUmumyJemi"></span>
    </div>
    <div style="display: flex; justify-content: space-between; margin: 3px 0; font-size: 11px;">
        <div><span class="kassir_text"></span> {{ request.user.username }}</div>
        <div id="receiptDate"></div>
    </div>
    <div style="text-align: center; font-size: 12px; margin-top: 8px; color: #777;">
        <p class="thank_you_for_your_purchase_text" style="margin: 2px;"></p>
    </div>
    <hr class="d-none receiptHr">
    <hr class="d-none receiptHr">
    <hr class="d-none receiptHr">
    <hr class="d-none receiptHr">
    <hr class="d-none receiptHr">
    <hr class="d-none receiptHr">
    <hr class="d-none receiptHr">
    <hr class="d-none receiptHr">
    <hr class="d-none receiptHr">
</div>




    <div class="container mt-5">
        <button class="btn btn-primary d-none" data-bs-toggle="modal" data-bs-target="#myModal">Открыть модальное окно</button>
        <div class="modal fade" id="myModal" tabindex="-1" aria-labelledby="modalLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="modalLabel">Введите данные</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <input type="text" class="form-control" id="userInput" placeholder="Ваш текст...">
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Закрыть</button>
                        <button type="button" class="btn btn-primary" id="submitBtn">Отправить</button>
                    </div>
                </div>
            </div>
        </div>
    </div>




<style>

.product-table-wrapper {
    overflow-x: auto;
    margin: 20px 0;
}
@media print {
    .receiptHr {
        display: block;
    }
}
.green_bg {
    background-color: rgb(170, 253, 170); /* Начальный цвет фона */
}

/* стиль для галочки успешной покупки START */
.overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.7);
    opacity: 0;
    transition: opacity 1s ease;
    z-index: 1; /* Чтобы затемнение было над всем остальным */
    pointer-events: none; /* Запрет на взаимодействие */
}
.checkmark-wrapper {
    width: 100px;
    height: 100px;
    z-index: 2; /* Чтобы галочка была выше затемнения */
    display: none; /* Скрываем по умолчанию */
    position: absolute;
    top:50%;
    left:50%;
}
.checkmark {
    width: 100%;
    height: 100%;
}
.checkmark-circle {
    stroke: #4caf50;
    stroke-width: 2;
    fill: none;
    stroke-dasharray: 157;
    stroke-dashoffset: 157;
    animation: draw-circle 1s ease forwards;
}
.checkmark-check {
    stroke: #4caf50;
    stroke-width: 2;
    stroke-dasharray: 48;
    stroke-dashoffset: 48;
    animation: draw-check 1s ease forwards;
    animation-delay: 1s;
}
@keyframes draw-circle {
    to {
        stroke-dashoffset: 0;
    }
}
@keyframes draw-check {
    to {
        stroke-dashoffset: 0;
    }
}

@media (max-width: 770px) {
    .sell_row {
        flex-direction: column;
        row-gap: 10px;
    } 
    #product_table {
        display: none;
    }
    .esasy-container {
        margin-top: 0px;
    }
    .sell-checkbox-for-mobile {
        display: inline-block;
    }
}
@media (min-width: 771px) {
 
    #product_table_card {
        display: none;
    }
    .esasy-container {
        margin-top: 50px;
    }
    .sell-checkbox-for-mobile {
        display: none;
    }
}
/* стиль для галочки успешной покупки END */

</style>

<script>
// Receipts
const receipt = document.getElementById('receipt')
const receipt_items_container = document.getElementById('receipt_items_id')
const receipts_umumy_jemi = document.getElementById('receiptsUmumyJemi')
const receiptDate = document.getElementById('receiptDate')
const writedCodeInput = document.getElementById('writedCode')
const addHandCodeBtn = document.getElementById('addHandCodeBtn')
const productBody = document.getElementById('product_body');
const show_big_price = document.getElementById('show_big_price');


const checkbox_for_sell_btn_in_phone = document.getElementById('checkbox_for_sell_btn_in_phone');
const checkbox_for_sell_btn_in_phone_input = document.getElementById('checkbox_for_sell_btn_in_phone_input');
const buyBtn2 = document.getElementById('buyBtn');
checkbox_for_sell_btn_in_phone_input.addEventListener('change', function() {
            if (checkbox_for_sell_btn_in_phone_input.checked === true) {
                console.log('tut2', 'ttuutt2');
                buyBtn2.classList.remove('d-none')
            } else {
                buyBtn2.classList.add('d-none')
            }
        });
checkScreenWidth()
function checkScreenWidth() {
    if (window.innerWidth < 771) {
        checkbox_for_sell_btn_in_phone.classList.remove('d-none')
        if (checkbox_for_sell_btn_in_phone.classList.checked) {
            buyBtn2.classList.remove('d-none')
        } else {
            if (!buyBtn2.classList.contains('d-none')) {
                buyBtn2.classList.add('d-none')
            }
        }
   
      
        console.log('Ширина экрана меньше 771 пикселя.');
    } else {
        if (!checkbox_for_sell_btn_in_phone.classList.contains('d-none')) {
            checkbox_for_sell_btn_in_phone.classList.add('d-none')
        }
        checkbox_for_sell_btn_in_phone_input.checked = false;
        buyBtn2.classList.remove('d-none')
        console.log('Ширина экрана больше или равна 771 пикселю.');
    }
}

// Добавляем обработчик события resize
window.addEventListener('resize', checkScreenWidth);



function printReceipt() {
    const receipt_innerHTML = receipt.innerHTML; // Получаем HTML содержимое чека
    const myWindow = window.open('', 'PrintWindow', 'height=600,width=1000');
    myWindow.document.write(`
        <div>
            ${receipt.innerHTML}
        </div>
    `);
    myWindow.document.close();
    myWindow.focus();
    myWindow.print(); // Открываем диалог печати
    myWindow.close(); // Закрываем новое окно
}

// Функция для получения CSRF токена для отправки инфо о продуктах при нажатии на купить
function getCookie(name) {
    let cookieValue = null;
    if (document.cookie && document.cookie !== '') {
        const cookies = document.cookie.split(';');
        for (let i = 0; i < cookies.length; i++) {
            const cookie = cookies[i].trim();
            if (cookie.substring(0, name.length + 1) === (name + '=')) {
                cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                break;
            }
        }
    }
    return cookieValue;
}
// Если нажал на купить END

function toSell(event) {

    // set date for receipt
    const currentDateTime = new Date();
    const formattedDateTime = currentDateTime.toLocaleString();
    receiptDate.innerText = formattedDateTime;
    event.target.disabled = true
    printReceipt();

    let productInfo = {}
    const rows = productBody.querySelectorAll('tr');  
    rows.forEach(tr => {
        // Получаем id элемента tr
        const productId = tr.id;
        // Убираем буквы и оставляем только цифры
        const productPK = productId.replace(/\D/g, '');
        const cells = tr.querySelectorAll('td');
        const stock_row = cells[2];
        const count_row = cells[3];
        const price_row = cells[6];
        const optom_row = cells[7];
        let price = 0
        if (parseInt(stock_row.innerText) != 0) {
            if (optom_check_box.checked) {
                price = optom_row.innerText
            } else {
                price = price_row.innerText
            }
            productInfo[productPK] = {'count':0, 'price':0}
            productInfo[productPK]['price'] = price
            productInfo[productPK]['count'] = count_row.querySelector('span').innerText
        } 
        
    });
    
    fetch('/shop/api/product_info_for_buy/', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json', // Указываем, что отправляем JSON данные
            'X-CSRFToken': getCookie('csrftoken') // Добавляем CSRF токен
        },
        body: JSON.stringify(productInfo) // Преобразуем объект в строку JSON
        
    })
    .then(response => response.json())
    .then(data => {
        // Для анимации галочки START
        const overlay = document.getElementById('overlay');
        const checkmarkWrapper = document.getElementById('checkmark-wrapper');
        // Показать затемнение и галочку
        setTimeout(() => {
            overlay.style.opacity = '1';
            checkmarkWrapper.style.display = 'block';
        }, 100);
        // После завершения анимации
        setTimeout(() => {
            // Убираем галочку и затемнение
            checkmarkWrapper.style.display = 'none';
            overlay.style.opacity = '0';
        }, 4000);
        successSound.play();
        
    })
}

function refreshReceipt() {
    const rows = productBody.querySelectorAll('tr');
    receipt_items_container.innerHTML = '';
    rows.forEach(tr => {
        const cells = tr.querySelectorAll('td');
        const x_row = cells[0];
        const name_row = cells[1];
        const stock_row = cells[2];
        const count_row = cells[3];
        const cub_row = cells[4];
        const price_purchase = cells[5];
        const price_row = cells[6];
        const optom_row = cells[7];
        const itogo_row = cells[8];

        let onePrice;
        let totalPrice;
        if (optom_check_box.checked) {
            onePrice = parseFloat(optom_row.innerText);
            totalPrice = onePrice * parseFloat(count_row.querySelector('span').innerText)
        } else {
            onePrice = parseFloat(price_row.innerText);
            totalPrice = onePrice * parseFloat(count_row.querySelector('span').innerText);
        }
        if (parseInt(stock_row.innerText) !=0) {
            const row = `
                <div style="display: flex; margin-bottom: 0px;">
                    <span style="margin: 3px 0; font-size: 11px; width: 35%;">${name_row.innerText}</span>
                    <span style="margin: 3px 0; font-size: 11px; width: 15%;">${count_row.querySelector('span').innerText}</span>
                    <span style="margin: 3px 0; font-size: 11px; width: 30%;">${parseInt(onePrice)}</span>
                    <span style="margin: 3px 0; font-size: 11px;">${parseInt(totalPrice)}</span>
                </div>
            `;
            receipt_items_container.innerHTML += row;
        }
    });

}

document.addEventListener('DOMContentLoaded', (event) => {
    const beepSound = document.getElementById('beepSound');
    const beepError = document.getElementById('beepError');
    const product_table = document.getElementById('product_table');
    
    const optom_check_box = document.getElementById('optom_check_box')
    const cubic_meter_footer = document.getElementById('cubic_meter_footer')
    const price_pursache_footer = document.getElementById('price_pursache_footer')
    const total_sum_footer = document.getElementById('total_sum_footer')
    const total_optom_footer = document.getElementById('total_optom_footer')
    const totalRow_footer = document.getElementById('totalRow_footer')
    const buyBtn = document.getElementById('buyBtn')

    const checkTable = productBody.querySelectorAll('tr')
    if (checkTable.length === 0) {
        buyBtn.disabled = true
    }

    let inputTimeout;
    qr_apparat_input.addEventListener('input', function () {
        const scannedCode = qr_apparat_input.value;
        clearTimeout(inputTimeout);
        inputTimeout = setTimeout(() => {
            sendScannedCode(scannedCode);
            qr_apparat_input.value = '';
        }, 300);
    });

    function addProduct(product) { 
        const trId = `product${product.id}`
        let existingTr = document.getElementById(trId);

        if (existingTr) {
            
            


            const getRow = document.getElementById(trId);
            incrementRow(getRow)
            refreshReceipt()
        
        } else {
            if (product_table.classList.contains('d-none')) {
                product_table.classList.remove('d-none')
            }
            const newRow = document.createElement('tr');
            newRow.id = trId;
            let totalRowPrice
            let cubic_m = product.cubic_meter
            let priceSaleCellClass = '';
            let priceSaleOptomCellClass = ''; 
            
            if (optom_check_box.checked) {
                totalRowPrice = product.price_sale_optom 
                priceSaleCellClass = 'text-decoration-line-through text-muted';
            } else {
                totalRowPrice = product.price_sale
                priceSaleOptomCellClass = 'text-decoration-line-through text-muted';
            }
            const stockIndicator = product.stock > 0 ? 1 : 0;
            if (stockIndicator === 0) {
                // newRow.classList.add('table-danger');
                totalRowPrice = 0
                cubic_m = 0
                beepError.play();
            } else {
                beepSound.play();
            }
            newRow.innerHTML = `
                <td>
                    <button class="btn btn-outline-secondary btn-sm me-2" title="x" onclick='deleteRow(${product.id})'>
                        x
                    </button>
                </td>
                <td class="product_name${product.id}">${product.name}</td>
                <td class="product_in_stock${product.id}">${Math.round(product.stock)}</td>
                <td class="product_count${product.id}">
                    <button class="btn btn-outline-secondary btn-sm me-2" title="Увеличить" onclick="incrementCount(${product.id})">
                        ↑
                    </button>
                    <span>${stockIndicator}</span>
                    <button class="btn btn-outline-secondary btn-sm me-2" title="Уменьшить" onclick="decrementCount(${product.id})">
                        ↓
                    </button>
                </td>
                <td class="cubic_meter${product.id}">${cubic_m}</td>
                <td class="price_purchase${product.id}">${Math.round(product.price_purchase)}</td>
                <td class="${priceSaleCellClass} price_sale${product.id}">
                    ${Math.round(product.price_sale)}
                    ${product.stock > 0  && !optom_check_box.checked ? `<img src="{% static 'icons/pen.png' %}" width="50" onclick="changePrice(event)">` : ''}
                </td>
                <td class="${priceSaleOptomCellClass} price_sale_optom${product.id} d-flex justify-content-between">
                    ${Math.round(product.price_sale_optom)}
                    ${product.stock > 0  && optom_check_box.checked ? `<img src="{% static 'icons/pen.png' %}" width="50" onclick="changePrice(event)">` : ''}
                </td>
                <td class="itogo${product.id}">${Math.round(totalRowPrice)}</td>
            `;
            // вставляем новый tr перед первым tr
            const firstRow = productBody.querySelector('tr');
            if (firstRow) {
                productBody.insertBefore(newRow, firstRow);
            } else {
                productBody.appendChild(newRow);
            }


            newRow.classList.add('green_bg');
            buyBtn.disabled = false
            
            refreshReceipt()

            
        

            const cubic_meter_selector = document.querySelectorAll('.cubic_meter')
            
            let cub = 0; 
            cubic_meter_selector.forEach(element => {
                console.log(element);
                
                cub += parseFloat(element.innerHTML)
            });
            cub = parseFloat(cub.toFixed(3));
            cubic_meter_footer.innerText = cub;
            refreshFooterItogTable()
        };
        refresh_all_product_rows_card()
    }

  

    function sendScannedCode(code) {
        if (code) {
            fetch(`/shop/product/${code.toString()}`, {
                method: 'GET', 
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': '{{ csrf_token }}',
                    'X-Source': 'kassa2GetProduct_QR_and_Bar'
                },
            }).then(response => {
                if (!response.ok) {
                    return response.json().then(errorData => {
                        throw new Error(errorData.error || 'Произошла ошибка');
                    });
                }
                return response.json();
            }).then(data => {
                console.log('Ответ от сервера:', data); // Проверка данных от сервера
                if (data.product) {
                    console.log('есть в базе', data.product);
                    addProduct(data.product);
                } else {
                    console.log('нет в базе');
                    beepError.play();      
                }
            }).catch(err => {
                console.error('Ошибка Catch:', err); // Вывод ошибки
                alert
            });
        }
    }

});

function addProduct2(product) { 
        const trId = `product${product.id}`
        let existingTr = document.getElementById(trId);

        if (existingTr) {
            const getRow = document.getElementById(trId);
            incrementRow(getRow)
            refreshReceipt()
        
        } else {
            if (product_table.classList.contains('d-none')) {
                product_table.classList.remove('d-none')
            }
            const newRow = document.createElement('tr');
            newRow.id = trId;
            let totalRowPrice
            let cubic_m = product.cubic_meter
            let priceSaleCellClass = '';
            let priceSaleOptomCellClass = ''; 
            
            if (optom_check_box.checked) {
                totalRowPrice = product.price_sale_optom 
                priceSaleCellClass = 'text-decoration-line-through text-muted';
            } else {
                totalRowPrice = product.price_sale
                priceSaleOptomCellClass = 'text-decoration-line-through text-muted';
            }
            const stockIndicator = product.stock > 0 ? 1 : 0;
            if (stockIndicator === 0) {
                // newRow.classList.add('table-danger');
                totalRowPrice = 0
                cubic_m = 0
                beepError.play();
            } else {
                beepSound.play();
            }
            newRow.innerHTML = `
                <td>
                    <button class="btn btn-outline-secondary btn-sm me-2" title="x" onclick='deleteRow(${product.id})'>
                        x
                    </button>
                </td>
                <td class="product_name${product.id}">${product.name}</td>
                <td class="product_in_stock${product.id}">${Math.round(product.stock)}</td>
                <td class="product_count${product.id}">
                    <button class="btn btn-outline-secondary btn-sm me-2" title="Увеличить" onclick="incrementCount(${product.id})">
                        ↑
                    </button>
                    <span>${stockIndicator}</span>
                    <button class="btn btn-outline-secondary btn-sm me-2" title="Уменьшить" onclick="decrementCount(${product.id})">
                        ↓
                    </button>
                </td>
                <td class="cubic_meter${product.id}">${cubic_m}</td>
                <td class="price_purchase${product.id}">${Math.round(product.price_purchase)}</td>
                <td class="${priceSaleCellClass} price_sale${product.id}">
                    ${Math.round(product.price_sale)}
                    ${product.stock > 0  && !optom_check_box.checked ? `<img src="{% static 'icons/pen.png' %}" width="50" onclick="changePrice(event)">` : ''}
                    </td>
                <td class="${priceSaleOptomCellClass} price_sale_optom${product.id} d-flex justify-content-between">
                    ${Math.round(product.price_sale_optom)}
                    ${product.stock > 0  && optom_check_box.checked ? `<img src="{% static 'icons/pen.png' %}" width="50" onclick="changePrice(event)">` : ''}
                </td>
                <td class="itogo${product.id}">${Math.round(totalRowPrice)}</td>
            `;
            // вставляем новый tr перед первым tr
            const firstRow = productBody.querySelector('tr');
            if (firstRow) {
                productBody.insertBefore(newRow, firstRow);
            } else {
                productBody.appendChild(newRow);
            }

            newRow.classList.add('green_bg');
            console.log('popopopopopopo');
            
            document.getElementById('buyBtn').disabled = false
            refreshReceipt()

            
        

            const cubic_meter_selector = document.querySelectorAll('.cubic_meter')
            
            let cub = 0; 
            cubic_meter_selector.forEach(element => {
                console.log(element);
                
                cub += parseFloat(element.innerHTML)
            });
            cub = parseFloat(cub.toFixed(3));
            cubic_meter_footer.innerText = cub;
            refreshFooterItogTable()
        };
        refresh_all_product_rows_card()
    }

function getProductFromPk(id) {
        console.log('iddddd', id);
        
        if (id) {
            fetch(`/shop/product_detail_with_id/${id.toString()}`, {
                method: 'GET', 
                headers: {
                    'Content-Type': 'application/json',
                },
            }).then(response => {
                if (!response.ok) {
                    return response.json().then(errorData => {
                        throw new Error(errorData.error || 'Произошла ошибка');
                    });
                }
                return response.json();
            }).then(data => {
                console.log('Ответ от сервера:', data); // Проверка данных от сервера
                if (data.product) {
                    console.log('есть в базе', data.product);
                    addProduct2(data.product);
                } else {
                    console.log('нет в базе');
                    beepError.play();      
                }
            }).catch(err => {
                console.error('Ошибка Catch:', err); // Вывод ошибки
                alert
            });
        }
    }




function changePrice(event) {
    const imgElement = event.target;
    const td = imgElement.closest('td');

    if (td) {
        // Сохраняем текущее содержимое в data-атрибуте
        td.setAttribute('data-original-content', td.innerHTML);
        
        td.innerHTML = `
            <div class="d-flex">
                <button class="btn btn-success btn-sm" onclick="cancelWritedPrice(event)">Отмена</button>  
                <input class="form-control priceWritedInput" style="width: 100px;" type="number" placeholder="Цена" /> 
                <button class="btn btn-success btn-sm" onclick="savePrice(event)">OK</button> 
            </div>
        `;

        // Находим новый input элемент и устанавливаем на него фокус
        const input = td.querySelector('.priceWritedInput');
        input.focus();
        document.getElementById('qr_apparat_input').disabled = true
        document.getElementById('optom_check_box').disabled = true 
        document.getElementById('buyBtn').disabled = true
    } else {
        console.error('TD элемент не найден');
    }
}


function cancelWritedPrice(event) {
    const td = event.target.closest('td');
    // Восстанавливаем изначальное содержимое
    if (td) {
        const originalContent = td.getAttribute('data-original-content');
        td.innerHTML = originalContent; // Вернуть оригинальный текст
    }
    document.getElementById('qr_apparat_input').disabled = false
    document.getElementById('optom_check_box').disabled = false
    document.getElementById('buyBtn').disabled = false
}


function savePrice(event) {
    const td = event.target.closest('td');
    const input = td.querySelector('.priceWritedInput');
    let price = input.value;
    if (price == '') {
        price = 0
    }
    // Здесь можно добавить логику для сохранения новой цены
    console.log("Новая цена:", price);
    // Например, обновляем содержимое ячейки
    td.innerHTML = price; // Меняем содержимое на новую цену
    td.innerHTML = `
            ${price}
            <img src="{% static 'icons/pen.png' %}" width="50" onclick="changePrice(event)">
        `;
    refreshTable()
    document.getElementById('qr_apparat_input').disabled = false 
    document.getElementById('optom_check_box').disabled = false
    document.getElementById('buyBtn').disabled = false
    refresh_all_product_rows_card()
}


function deleteRow(id) {
    row = document.getElementById(`product${id}`)
    row.remove();
    refreshTable();
    refreshReceipt()
    refresh_all_product_rows_card()

}


function incrementRow(row) {
        const cells = row.querySelectorAll('td');
        const stock_row = cells[2]
        const count_row = cells[3]
        const cub_row = cells[4]
        const price_purchase = cells[5]
        const price_row = cells[6]
        const optom_row = cells[7]
        const itogo_row = cells[8]
        


        if (parseInt(stock_row.innerText) >= parseInt(count_row.querySelector('span').innerText) + 1) {
            count_row.querySelector('span').innerText = parseFloat(count_row.querySelector('span').innerText) + 1
            if (optom_check_box.checked) {
                itogo_row.innerText = Math.round(parseFloat(count_row.querySelector('span').innerText) * parseFloat(optom_row.innerText))
            } else {
                itogo_row.innerText = Math.round(parseFloat(count_row.querySelector('span').innerText) * parseFloat(price_row.innerText))
            }
            // cub_row.innerText = (parseFloat(cub_row.innerText) / parseFloat(count_row.querySelector('span').innerText) * parseFloat(count_row.querySelector('span').innerText)).toFixed(2)
            refreshFooterItogTable()
            const rows = document.getElementById('product_body').querySelectorAll('tr');
            rows.forEach(tr => {
                if (tr.classList.contains('green_bg')) {
                    tr.classList.remove('green_bg')
                }
            })  
            row.classList.add('green_bg');
            beepSound.play();
        } else {
            const rows = document.getElementById('product_body').querySelectorAll('tr');
            rows.forEach(tr => {
                if (tr.classList.contains('green_bg')) {
                    tr.classList.remove('green_bg')
                }
            })
            row.classList.add('green_bg');
            beepError.play();
        }
    }

// Если кликнул стрелку вверх
function incrementCount(id) {
        const row = document.getElementById(`product${id}`)
        incrementRow(row) 
        refreshReceipt()  
        refresh_all_product_rows_card()
    }

// Если кликнул стрелку вниз
function decrementCount(id) {
        const row = document.getElementById(`product${id}`) 
        const cells = row.querySelectorAll('td');
        const stock_row = cells[2]
        const count_row = cells[3]
        const cub_row = cells[4]
        const price_purchase = cells[5]
        const price_row = cells[6]
        const optom_row = cells[7]
        const itogo_row = cells[8]

        if (parseInt(count_row.querySelector('span').innerText) - 1 > 0) {
            count_row.querySelector('span').innerText = parseFloat(count_row.querySelector('span').innerText) - 1
            if (optom_check_box.checked) {
                itogo_row.innerText = Math.round(parseFloat(count_row.querySelector('span').innerText) * parseFloat(optom_row.innerText))
            } else {
                itogo_row.innerText = Math.round(parseFloat(count_row.querySelector('span').innerText) * parseFloat(price_row.innerText))
            }
            // cub_row.innerText = (parseFloat(cub_row.innerText) / parseFloat(count_row.querySelector('span').innerText) * parseFloat(count_row.querySelector('span').innerText)).toFixed(2)
            refreshFooterItogTable()
            const rows = document.getElementById('product_body').querySelectorAll('tr');
            rows.forEach(tr => {
                if (tr.classList.contains('green_bg')) {
                    tr.classList.remove('green_bg')
                }
            })  
            row.classList.add('green_bg');
            beepSound.play();
        } else {
            const rows = document.getElementById('product_body').querySelectorAll('tr');
            rows.forEach(tr => {
                if (tr.classList.contains('green_bg')) {
                    tr.classList.remove('green_bg')
                }
            })
            row.classList.add('green_bg');
            beepError.play();
        }
        refreshReceipt()
        refresh_all_product_rows_card()
    }
    
// для добавления классов text-decoration-line-through и text-muted в зависимости от того optom_check_box checked или нет
function toggleClass(element, className, add) {
    if (add) {
        element.classList.add(className);
    } else {
        element.classList.remove(className);
    }
}

function refreshFooterItogTable() {
    const rows = document.getElementById('product_body').querySelectorAll('tr');
    let footerTotalCub = 0;
    let footerTotalPurchase = 0;
    let footerTotalPrice = 0;
    let footerTotalOptom = 0;
    let footerTotalItogo = 0;
    rows.forEach((tr, index) => {
        if (index != 0) {
            if (tr.classList.contains('green_bg')) {
                tr.classList.remove('green_bg')
            }
        }
        const cells = tr.querySelectorAll('td');
        const count_row = cells[3]
        const cub_row = cells[4]
        const price_purchase = cells[5]
        const price_row = cells[6]
        const optom_row = cells[7]
        const itogo_row = cells[8]
        footerTotalCub += parseFloat(cub_row.innerHTML) * parseFloat(count_row.querySelector('span').innerText)
        footerTotalPurchase += parseFloat(price_purchase.innerHTML)
        footerTotalPrice += parseFloat(price_row.innerHTML)
        footerTotalOptom += parseFloat(optom_row.innerHTML)
        footerTotalItogo += parseFloat(itogo_row.innerHTML)
    })
    cubic_meter_footer.innerText =  footerTotalCub.toFixed(3)
    totalRow_footer.innerText = Math.round(footerTotalItogo)   
    receipts_umumy_jemi.innerText = totalRow_footer.innerText
    show_big_price.innerText = totalRow_footer.innerText
}

// Обновление table
function refreshTable() {
    const rows = document.getElementById('product_body').querySelectorAll('tr');

    if (rows.length === 0) {
        product_table.classList.add('d-none')
        console.log('tut');
        
        document.getElementById('buyBtn').disabled = true
    } else {
        buyBtn.disabled = false
    }
    

    // Итерация по строкам
    rows.forEach(tr => {
        const cells = tr.querySelectorAll('td');
        const x_row = cells[0]
        const name_row = cells[1]
        const stock_row = cells[2]
        const count_row = cells[3]
        const cub_row = cells[4]
        const price_purchase = cells[5]
        const price_row = cells[6]
        const optom_row = cells[7]
        const itogo_row = cells[8]    

        if (optom_check_box.checked) {

            let priceRowContent = price_row.innerHTML;
            if (priceRowContent.includes('<img')) {
                // Извлекаем тег <img>
                const imgTag = priceRowContent.match(/<img[^>]*>/)[0]; // Находим первый тег <img>
                
                // Устанавливаем тег <img> в optom_row
                optom_row.innerHTML += imgTag; // Добавляем <img> в optom_row

                // Удаляем тег <img> из price_row
                price_row.innerHTML = priceRowContent.replace(imgTag, ''); // Удаляем <img> из price_row
            }
            
            toggleClass(price_row, 'text-decoration-line-through', true);
            toggleClass(price_row, 'text-muted', true);
            toggleClass(optom_row, 'text-muted', false);
            toggleClass(optom_row, 'text-decoration-line-through', false);
            itogo_row.innerText = parseFloat(optom_row.innerText) * parseFloat(count_row.querySelector('span').innerText)
        } else {

            let priceRowContent = optom_row.innerHTML;
            if (priceRowContent.includes('<img')) {
                // Извлекаем тег <img>
                const imgTag = priceRowContent.match(/<img[^>]*>/)[0]; // Находим первый тег <img>
                
                // Устанавливаем тег <img> в optom_row
                price_row.innerHTML += imgTag; // Добавляем <img> в optom_row

                // Удаляем тег <img> из price_row
                optom_row.innerHTML = priceRowContent.replace(imgTag, ''); // Удаляем <img> из price_row
            }

            toggleClass(price_row, 'text-decoration-line-through', false);
            toggleClass(price_row, 'text-muted', false);
            toggleClass(optom_row, 'text-muted', true);
            toggleClass(optom_row, 'text-decoration-line-through', true);
            itogo_row.innerText = parseFloat(price_row.innerText) * parseFloat(count_row.querySelector('span').innerText)
        }
    });
    refreshFooterItogTable()
    refreshReceipt()
}

optom_check_box.addEventListener('change', function() {
    refreshTable();
    refresh_all_product_rows_card()
    if (optom_check_box.checked) {
        

    }
});


// window.addEventListener('scroll', () => {
//     let scrollY = window.scrollY; // Получаем текущую позицию скролла
//     console.log(`Положение скролла: ${scrollY}`); // Обновляем текст в элементе
// });


function refresh_all_product_rows_card() {
    const scrollY = window.scrollY;

    const all_beeped_products = productBody.querySelectorAll('tr')
    const product_table_card_rows = document.getElementById('product_table_card_rows')
    const totalRow_footer_for_card = document.getElementById('totalRow_footer').innerText
    const cubic_meter_footer_for_card = document.getElementById('cubic_meter_footer').innerText
    const product_umumy_total_card = document.getElementById('product_umumy_total_card')
    const product_umumy_total_cubic_card = document.getElementById('product_umumy_total_cubic_card')
    const product_footer_card = document.getElementById('product_footer_card')
    product_umumy_total_card.innerText = totalRow_footer_for_card;
    product_umumy_total_cubic_card.innerText = cubic_meter_footer_for_card;
    product_table_card_rows.innerHTML = '';
 

    if (all_beeped_products.length > 0) {
        if (product_footer_card.classList.contains('d-none')) {
            product_footer_card.classList.remove('d-none')
        }
    } else {
        if (!product_footer_card.classList.contains('d-none')) {
            product_footer_card.classList.add('d-none')
        }
    }
    
    

    all_beeped_products.forEach(row => {
        const cells = row.querySelectorAll('td');
        const product_name = cells[1].innerText
        const stock_row = cells[2].innerText
        const count_row = cells[3].querySelector('span').innerText
        const cub_row = cells[4].innerText
        const price_purchase = cells[5].innerText
        const price_row = cells[6].innerText
        const optom_row = cells[7].innerText
        const itogo_row = cells[8].innerText


        

        
        const get_id = row.id.replace(/product/g, '');
       
        if (optom_check_box.checked) {
            text_primary_for_optom = 'text-primary'
            text_primary_for_price = 'text-decoration-line-through text-muted'
        } else {
            text_primary_for_optom = 'text-decoration-line-through text-muted'
            text_primary_for_price = 'text-primary'
        }

        product_table_card_rows.insertAdjacentHTML('beforeend', `
                <div class="card product-card">
                    <div class="card-body">
                        <div class="d-flex justify-content-between">
                            <button class="btn btn-outline-secondary btn-sm me-2" title="x" onclick='deleteRow(${get_id})'>
                                x
                            </button>
                            <h6 class="card-title text-center" class="product_name_card">${product_name}</h6>
                        </div>
                        <div class="card-text d-flex" style="background-color: #f0f0f0; padding: 0 2px; border-radius: 5px;">
                            <div style="width: 150px;">Склад</div>
                            <div class="product_stock_card">${stock_row}</div>
                        </div>
                        <div class="card-text d-flex" style="padding: 0 2px;">
                            <div style="width: 150px;">Количество</div>
                            <div class="d-flex">
                                <div class="product_count_card text-primary me-3">${count_row}</div>
                                <button class="btn btn-outline-secondary btn-sm me-3" title="Увеличить" onclick="incrementCount(${get_id})">
                                    ↑
                                </button>
                                <button class="btn btn-outline-secondary btn-sm me-2" title="Уменьшить" onclick="decrementCount(${get_id})">
                                    ↓
                                </button>
                            </div>
                        </div>
                        <div class="card-text d-flex" style="background-color: #f0f0f0; padding: 0 2px; border-radius: 5px;">
                            <div style="width: 150px;">M<sup>3</sup> </div>
                            <div class="product_cubic_card">${cub_row}</div>
                        </div>
                        <div class="card-text d-flex" style="padding: 0 2px;">
                            <div style="width: 150px;">Покупка</div>
                            <div class="product_purchase_card">${Math.round(price_purchase)}</div>
                        </div>
                        <div class="card-text d-flex" style="background-color: #f0f0f0; padding: 0 2px; border-radius: 5px;">
                            <div style="width: 150px;">Продажа</div>
                            <div class="product_sell_card ${text_primary_for_price}">${Math.round(price_row)}</div>
                        </div>
                        <div class="card-text d-flex" style="padding: 0 2px;">
                            <div style="width: 150px;">Оптом</div>
                            <div class="product_optom_card ${text_primary_for_optom}">${Math.round(optom_row)}</div>
                        </div>
                        <div class="text-primary d-flex" style="background-color: #f0f0f0; padding: 0 2px; border-radius: 5px;">
                            <h6 class="product_total_card">${Math.round(itogo_row)}</h6>
                            <div style="margin-left: 5px;">m</div>
                        </div>
                        
                    </div>
                </div>
            `
            )     
    });
    window.scrollTo(0, scrollY);

}




</script>



<!-- Скрипт для ручного ввода qr теуста -->
<script>
    document.getElementById('handQRToggleButton').addEventListener('click', function() {
        const qrContainer = document.getElementById('qrHandInputContainer');
        qrContainer.classList.toggle('d-none');
    });
</script>



<!-- для автофокуса qr apparat input -->
<script>
    const qr_apparat_input = document.getElementById('qr_apparat_input')
    const qr_hand_input = document.getElementById('qr_hand_input')
    const search_word_id = document.getElementById('search_word_id')
    setInterval(function() {
    if (document.activeElement !== qr_hand_input 
        &&
        document.activeElement !== search_word_id
        && 
        !document.activeElement.classList.contains('priceWritedInput')) {
        qr_apparat_input.focus();

        if (document.getElementById("camera-indicator").classList.contains('d-none')) {
            document.getElementById("camera-indicator").classList.remove('d-none')
        }
    } else {
        if (!document.getElementById("camera-indicator").classList.contains('d-none')) {
            document.getElementById("camera-indicator").classList.add('d-none')
        }
    }
}, 300);
</script>


<script>
    // receipts
    const receipts_address_text = document.querySelectorAll('.receipts_address_text')
    const ReceiptsAddressText = {
        'RU': 'Magtymguly Şayoly, 7/2',
        'TM': 'Magtymguly Şayoly, 7/2',
        'EN': 'Magtymguly Şayoly, 7/2'
    };    
    receipts_address_text.forEach((element, index) => {
        element.innerHTML = ReceiptsAddressText[checkLanguage] || ReceiptsAddressText['TM'];
    });

    const receipt_shop_name_text = document.querySelectorAll('.receipt_shop_name_text')
    const ReceiptShopNameText = {
        'RU': 'Магазин "VESTEL"',
        'TM': 'Dükan "VESTEL"',
        'EN': 'Store "VESTEL"'
    };    
    receipt_shop_name_text.forEach((element, index) => {
        element.innerHTML = ReceiptShopNameText[checkLanguage] || ReceiptShopNameText['TM'];
    });

    const receipts_store_tel_number_text = document.querySelectorAll('.receipts_store_tel_number_text')
    const ReceiptsStoreTelNumberText = {
        'RU': 'Тел: +993 65 26 56 77, +993 65 09 50 10',
        'TM': 'Tel: +993 65 26 56 77, +993 65 09 50 10',
        'EN': 'Phone: +993 65 26 56 77, +993 65 09 50 10'
    };    
    receipts_store_tel_number_text.forEach((element, index) => {
        element.innerHTML = ReceiptsStoreTelNumberText[checkLanguage] || ReceiptsStoreTelNumberText['TM'];
    });

    const product_text_in_heder_to_receipt_rows = document.querySelectorAll('.product_text_in_heder_to_receipt_rows')
    const ProductTextInHederToReceiptTows = {
        'RU': 'Товар',
        'TM': 'Haryt',
        'EN': 'Product'
    };    
    product_text_in_heder_to_receipt_rows.forEach((element, index) => {
        element.innerHTML = ProductTextInHederToReceiptTows[checkLanguage] || ProductTextInHederToReceiptTows['TM'];
    });

    const count_text_in_heder_to_receipt_rows = document.querySelectorAll('.count_text_in_heder_to_receipt_rows')
    const CountTextInHederToReceiptRows = {
        'RU': 'шт.',
        'TM': 'sany',
        'EN': 'pcs'
    };    
    count_text_in_heder_to_receipt_rows.forEach((element, index) => {
        element.innerHTML = CountTextInHederToReceiptRows[checkLanguage] || CountTextInHederToReceiptRows['TM'];
    });

    const price_to_one_ps_text_in_heder_to_receipt_rows = document.querySelectorAll('.price_to_one_ps_text_in_heder_to_receipt_rows')
    const PriceToOnePsTextInHederToReceiptRows = {
        'RU': 'за 1 шт.',
        'TM': '1san baha',
        'EN': 'per item'
    };    
    price_to_one_ps_text_in_heder_to_receipt_rows.forEach((element, index) => {
        element.innerHTML = PriceToOnePsTextInHederToReceiptRows[checkLanguage] || PriceToOnePsTextInHederToReceiptRows['TM'];
    });

    const total_text_in_heder_to_receipt_rows = document.querySelectorAll('.total_text_in_heder_to_receipt_rows')
    const TotalTextInHederToReceiptRows = {
        'RU': 'Итого',
        'TM': 'Jemi',
        'EN': 'Total'
    };    
    total_text_in_heder_to_receipt_rows.forEach((element, index) => {
        element.innerHTML = TotalTextInHederToReceiptRows[checkLanguage] || TotalTextInHederToReceiptRows['TM'];
    });


    const thank_you_for_your_purchase_text = document.querySelectorAll('.thank_you_for_your_purchase_text')
    const ThankYouForYourPurchaseText = {
        'RU': 'Спасибо за покупку!',
        'TM': 'Satyn alanyňyz üçin sag boluň!',
        'EN': 'Thank you for your purchase!'
    };    
    thank_you_for_your_purchase_text.forEach((element, index) => {
        element.innerHTML = ThankYouForYourPurchaseText[checkLanguage] || ThankYouForYourPurchaseText['TM'];
    });

    const kassir_text = document.querySelectorAll('.kassir_text')
    const KassirText = {
        'RU': 'Кассир: ',
        'TM': 'Kassir: ',
        'EN': 'Cashier: '
    };    
    kassir_text.forEach((element, index) => {
        element.innerHTML = KassirText[checkLanguage] || KassirText['TM'];
    });

    const buy_btn = document.querySelectorAll('.buyBtn')
    const buyBtn = {
        'RU': 'Купить',
        'TM': 'Almak',
        'EN': 'Buy'
    };    
    buy_btn.forEach((element, index) => {
        element.innerHTML = buyBtn[checkLanguage] || buyBtn['TM'];
    });
</script>



{% endblock content %}
