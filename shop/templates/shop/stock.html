{% extends "shop/base.html" %}
{% load static %}
{% load humanize %}
{% load my_filters %}
{% block title %}–ö–≤–∏—Ç–∞–Ω—Ü–∏–∏{% endblock %}

{% block content %}

<div class="container mt-5 no-print">
    <form method="GET">
        <div class="row align-items-end">
            <div class="col-12 col-md-4 mb-3">
                <label for="name" class="form-label">–ù–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–æ–¥—É–∫—Ç–∞</label>
                <input type="text" name="name" id="name" class="form-control" {% if name %}value="{{name}}"{% endif %} autocomplete="off">
            </div>
            
            <div class="col-12 col-md-4 mb-3">
                <label for="count" class="form-label">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–æ–¥—É–∫—Ç–∞</label>
                <input type="text" name="count" id="count" class="form-control" {% if count %}value="{{count}}"{% endif %} autocomplete="off">
            </div>

            <div class="col-12 col-md-4 mb-3">
                <button type="submit" class="btn btn-primary">–ü–æ–∏—Å–∫</button>
            </div>
        </div>
    </form>
</div>

<!-- –°–∫–∞—á–∞—Ç—å excel -->
<form method="POST" class="text-center no-print">{% csrf_token %}
    <input type="hidden" name="download_excel">
    <button type="submit" class="submit-excel"><img src="{% static 'icons/excel_icon.png' %}" alt="" width="100" class="excel-icon"></button>
</form>
<div class="text-center no-print">
    <button class="btn btn-primary mb-2" onclick="window.print()">üñ®Ô∏è –ü–µ—á–∞—Ç—å</button>
</div>
<div class="container-fluid mb-5" style="background-color: white;">
    <div class="table-responsive no-print">
        <table class="table table-bordered table-hover">
            <thead>
                <tr>
                    <th>–¢–æ–≤–∞—Ä—ã <span class="text-danger" style="font-size: 19px;">({{lenProducts}})</span></th>
                    
                    <!-- <th>–¶–µ–Ω–∞ –ø—Ä–æ–¥–∞–∂–∏</th>
                    <th>–¶–µ–Ω–∞ –æ–ø—Ç–æ–º</th> -->
                    <th>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –Ω–∞ —Å–∫–ª–∞–¥–µ</th>
                    <th>–¶–µ–Ω–∞ –ø–æ–∫—É–ø–∫–∏</th>
                    <th>–ú<sup>3</sup></th>
                    <th>–°—É–º–º–∞ —Ç–æ–≤–∞—Ä–æ–≤ –Ω–∞ —Å–∫–ª–∞–¥–µ <br><span class="text-danger" style="font-size: 19px;">({{ total_purchase|my_format_price }})</span></th>
                </tr>
            </thead>
            <tbody>
                {% for product in products %}
                <tr>
                    <td>{{ product.name }}</td>
                    <td>{{ product.stock|floatformat:0 }}</td>
                    <td>{{ product.price_purchase|floatformat:"-2"|intcomma }}</td>
                    <!-- <td>{{ product.price_sale|my_format_price }}</td>
                    <td>{{ product.price_sale_optom|my_format_price }}</td> -->
                    <td>{{ product.cubic_meter|floatformat:"-3"|intcomma }}</td>
                    <td>{{ product.count_multyply_purchase|floatformat:"-2"|intcomma }}</td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="5" class="text-center">–ù–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –ø—Ä–æ–¥—É–∫—Ç–æ–≤</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <!-- productsAll -->
    <div class="table-responsive d-none for-print">
        <table class="table table-bordered table-hover">
            <thead>
                <tr>
                    <th>–¢–æ–≤–∞—Ä—ã <span class="text-danger" style="font-size: 19px;">({{lenProducts}})</span></th>
                    <th>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –Ω–∞ —Å–∫–ª–∞–¥–µ</th>
                    <th>–¶–µ–Ω–∞ –ø–æ–∫—É–ø–∫–∏</th>
                    <!-- <th>–¶–µ–Ω–∞ –ø—Ä–æ–¥–∞–∂–∏</th>
                    <th>–¶–µ–Ω–∞ –æ–ø—Ç–æ–º</th> -->
                    <th>–ú<sup>3</sup></th>
                    <th>–°—É–º–º–∞ —Ç–æ–≤–∞—Ä–æ–≤ –Ω–∞ —Å–∫–ª–∞–¥–µ <br><span class="text-danger" style="font-size: 19px;">({{ total_purchase|my_format_price }})</span></th>
                </tr>
            </thead>
            <tbody>
                {% for product in productsAll %}
                <tr>
                    <td>{{ product.name }}</td>
                    <!-- <td>{{ product.price_sale|my_format_price }}</td>
                    <td>{{ product.price_sale_optom|my_format_price }}</td> -->
                    <td>{{ product.stock|floatformat:"-2"|intcomma }}</td>
                    <td>{{ product.price_purchase|floatformat:"-2"|intcomma }}</td>
                    <td>{{ product.cubic_meter|floatformat:"-2"|intcomma }}</td>
                    <td>{{ product.count_multyply_purchase|floatformat:"-2"|intcomma }}</td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="5" class="text-center">–ù–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –ø—Ä–æ–¥—É–∫—Ç–æ–≤</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <!-- –ü–∞–≥–∏–Ω–∞—Ü–∏—è -->
    {% if products.has_previous or products.has_next %}
        <nav aria-label="Page navigation" class="my-4 no-print">
            <ul class="pagination justify-content-center">
                {% if products.has_previous %}
                    <li class="page-item">
                        <a class="page-link" href="?page=1{% if name %}&name={{ name }}{% endif %}{% if count %}&count={{ count }}{% endif %}" aria-label="First">
                            <span aria-hidden="true">&laquo; –ü–µ—Ä–≤—ã–π</span>
                        </a>
                    </li>
                {% endif %}

                {% for num in products.paginator.page_range %}
                    {% if products.number == num %}
                        <li class="page-item active" aria-current="page">
                            <span class="page-link">{{ num }}</span>
                        </li>
                    {% else %}
                        <li class="page-item">
                            <a class="page-link" href="?page={{ num }}{% if name %}&name={{ name }}{% endif %}{% if count %}&count={{ count }}{% endif %}">{{ num }}</a>
                        </li>
                    {% endif %}
                {% endfor %}

                {% if products.has_next %}
                    <li class="page-item">
                        <a class="page-link" href="?page={{ products.paginator.num_pages }}{% if name %}&name={{ name }}{% endif %}{% if count %}&count={{ count }}{% endif %}" aria-label="Last">
                            <span aria-hidden="true">–ü–æ—Å–ª–µ–¥–Ω–∏–π &raquo;</span>
                        </a>
                    </li>
                {% endif %}
            </ul>
        </nav>
    {% endif %}
</div>

<style>


.pagination {
    margin: 20px 0;
}

.page-item .page-link {
    border-radius: 5px;
    transition: background-color 0.3s ease;
}

.page-item.active .page-link {
    background-color: #007bff;
    color: #fff;
    border: 1px solid #007bff;
}

.page-item .page-link:hover {
    background-color: #0056b3;
    color: white;
}

.page-item.disabled .page-link {
    color: #6c757d;
    pointer-events: none;
    background-color: transparent;
}

.page-item .page-link {
    margin: 0 5px;
}

.table th, .table td {
    white-space: nowrap; /* –ó–∞–ø—Ä–µ—Ç–∏—Ç—å –ø–µ—Ä–µ–Ω–æ—Å —Ç–µ–∫—Å—Ç–∞ */
    overflow: hidden; /* –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ —Ç–µ–∫—Å—Ç –Ω–µ –≤—ã—Ö–æ–¥–∏—Ç –∑–∞ –ø—Ä–µ–¥–µ–ª—ã */
    text-overflow: ellipsis; /* –î–æ–±–∞–≤–∏—Ç—å –º–Ω–æ–≥–æ—Ç–æ—á–∏–µ –¥–ª—è –¥–ª–∏–Ω–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞ */
}

.excel-icon {
    transition: transform 0.2s, filter 0.2s; /* –ê–Ω–∏–º–∞—Ü–∏—è –¥–ª—è —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏–∏ –∏ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ */
    cursor: pointer; /* –ò–∑–º–µ–Ω–µ–Ω–∏–µ —É–∫–∞–∑–∞—Ç–µ–ª—è –Ω–∞ –∫—É—Ä—Å–æ—Ä */
}

.excel-icon:hover {
    transform: scale(1.1); /* –£–≤–µ–ª–∏—á–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–∞ –ø—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏ */
    filter: brightness(1.2); /* –£–≤–µ–ª–∏—á–µ–Ω–∏–µ —è—Ä–∫–æ—Å—Ç–∏ –ø—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏ */
}

.excel-icon:active {
    transform: scale(0.95); /* –£–º–µ–Ω—å—à–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–∞ –ø—Ä–∏ –∫–ª–∏–∫–µ */
    filter: brightness(1); /* –ò–∑–º–µ–Ω–µ–Ω–∏–µ —è—Ä–∫–æ—Å—Ç–∏ –æ–±—Ä–∞—Ç–Ω–æ –Ω–∞ –Ω–æ—Ä–º—É */
}


.submit-excel {
    background: none; /* –£–±–∏—Ä–∞–µ–º —Ñ–æ–Ω–æ–≤—ã–π —Ü–≤–µ—Ç */
    border: none; /* –£–±–∏—Ä–∞–µ–º —Ä–∞–º–∫—É */
    padding: 0; /* –£–±–∏—Ä–∞–µ–º –æ—Ç—Å—Ç—É–ø—ã */
    cursor: pointer; /* –ò–∑–º–µ–Ω—è–µ–º —É–∫–∞–∑–∞—Ç–µ–ª—å –Ω–∞ –∫—É—Ä—Å–æ—Ä */
}

.submit-excel:focus {
    outline: none; /* –£–±–∏—Ä–∞–µ–º –∫–æ–Ω—Ç—É—Ä –ø—Ä–∏ —Ñ–æ–∫—É—Å–µ, –µ—Å–ª–∏ –Ω—É–∂–µ–Ω –≤–∏–∑—É–∞–ª—å–Ω–æ */
}

/* .submit-excel img {
    display: block;
    width: 100px; 
    height: auto; 
} */

@media print {
    .no-print {
        display: none; /* –°–∫—Ä—ã—Ç–∏–µ —ç–ª–µ–º–µ–Ω—Ç–∞ –ø—Ä–∏ –ø–µ—á–∞—Ç–∏ */
    }
    .for-print {
        font-size: 12px;
        display: block !important;
    }
}
</style>



<script>
    // —Å–∫—Ä–æ–ª–ª –∫ –ø–∞–≥–∏–Ω–∞—Ü–∏–∏
document.querySelectorAll('.page-link').forEach(function (link) {
    link.addEventListener('click', function (e) {
        e.preventDefault();
        const target = this.getAttribute('href');
        window.location.href = target;
    });
});
</script>






<!-- <h1>–û—Ç–∫—Ä—ã—Ç—å –∫–∞–º–µ—Ä—É</h1>
    <button id="openCamera">–û—Ç–∫—Ä—ã—Ç—å –∫–∞–º–µ—Ä—É</button>
    <video id="video" width="640" height="480" autoplay></video>

    <script>
        const openCameraButton = document.getElementById('openCamera');
        const videoElement = document.getElementById('video');

        openCameraButton.addEventListener('click', async () => {
            try {
                // –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ–º –¥–æ—Å—Ç—É–ø –∫ –≤–∏–¥–µ–æ–ø–æ—Ç–æ–∫—É
                const stream = await navigator.mediaDevices.getUserMedia({
                    video: { facingMode: 'environment' } // –æ—Å–Ω–æ–≤–Ω–æ–π –∫–∞–º–µ—Ä–∞
                });
                // –ü—Ä–∏–≤—è–∑—ã–≤–∞–µ–º –≤–∏–¥–µ–æ–ø–æ—Ç–æ–∫ –∫ video —ç–ª–µ–º–µ–Ω—Ç—É
                videoElement.srcObject = stream;
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ –∫–∞–º–µ—Ä–µ: ', error);
            }
        });
    </script> -->


{% endblock content %}